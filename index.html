<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Forecast</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c5a9c;
            --secondary-color: #3e7ac2;
            --accent-color: #00aaff;
            --text-color: #f0f4f8;
            --bg-light: rgba(255, 255, 255, 0.15);
            --bg-hover: rgba(255, 255, 255, 0.25);
            --border-radius: 8px;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.6;
        }

        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: var(--text-color);
            width: 100%;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            position: relative;
            border-bottom: 2px solid var(--accent-color);
        }

        h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0;
            letter-spacing: 1px;
        }

        .language-tabs {
            position: absolute;
            top: 1rem;
            right: 2%;
            left: auto;
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }

        .lang-btn {
            background: transparent;
            border: 1px solid var(--text-color);
            border-radius: var(--border-radius);
            padding: 0.4rem;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        .lang-btn.active,
        .lang-btn:hover {
            background: var(--accent-color);
            transform: scale(1.05);
            border-color: var(--accent-color);
        }

        .lang-btn img {
            display: block;
            width: 1.8rem;
            height: 1.35rem;
            border-radius: 3px;
        }

        #weather-icon {
            margin-top: 1rem;
            color: #ffca28;
        }

        .sun, .cloud, .rain, .snow, .lightning {
            fill: currentColor;
        }

        #weather-banner {
            width: 100%;
            padding: 1rem;
            text-align: center;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            animation: fadeIn 2s ease-in, slideDown 1s ease-out;
            box-sizing: border-box;
            background-color: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        main {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.25rem;
            max-width: 800px;
            width: 90%;
            gap: 1.25rem;
        }

        .weather-info,
        .advanced-weather-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(12.5rem, 1fr));
            gap: 1rem;
            width: 100%;
        }

        @media (min-width: 1024px) {
            .weather-info,
            .advanced-weather-info {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .weather-item {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: var(--bg-light);
            padding: 1.25rem;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s, background-color 0.3s;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        .weather-item span:first-child {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--accent-color);
        }

        .weather-item span:last-child {
            font-size: 1.3rem;
            font-weight: 300;
        }

        .weather-item:hover {
            transform: translateY(-5px);
            background-color: var(--bg-hover);
        }

        .map-container {
            margin-top: 1.25rem;
            width: 100%;
            height: 18.75rem;
            border-radius: var(--border-radius);
            overflow: hidden;
            background-color: #cfd8dc;
        }

        .location-input {
            margin-bottom: 1.25rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.625rem;
            position: relative;
        }

        .autocomplete-container {
            position: relative;
            flex: 1 1 12.5rem;
        }

        .suggestions-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #fff;
            color: #333;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
        }

        .suggestion-item {
            padding: 0.75rem;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background-color: #f0f0f0;
        }

        .location-input input,
        .location-input select,
        .location-input button {
            padding: 0.8rem;
            font-size: 1rem;
            border: 1px solid #b0bec5;
            border-radius: var(--border-radius);
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: rgba(255,255,255,0.9);
            color: #333;
        }

        .location-input input:focus,
        .location-input select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 8px rgba(0, 170, 255, 0.5);
        }

        .location-input input {
            flex: 1 1 12.5rem;
        }

        .location-input select,
        .location-input button {
            flex: 1 1 9.375rem;
        }

        .location-input button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
        }

        .location-input button:hover {
            background-color: #0099e6;
        }

        #toggle-advanced {
            width: 100%;
            padding: 1rem;
            font-size: 1.125rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 1.25rem;
            font-weight: 700;
        }

        #toggle-advanced:hover {
            background-color: #0099e6;
        }

        footer {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            padding: 2rem;
            margin-top: 2rem;
            text-align: center;
            border-top: 2px solid var(--accent-color);
            width: 100%;
            box-sizing: border-box;
        }

        .social-icons {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .social-icons a {
            color: var(--text-color);
            transition: color 0.3s ease, transform 0.3s;
        }

        .social-icons a:hover {
            color: var(--accent-color);
            transform: scale(1.1);
        }

        .social-icons svg {
            width: 2rem;
            height: 2rem;
        }

        .footer-links {
            margin-bottom: 1rem;
        }

        .footer-links a {
            color: var(--text-color);
            text-decoration: none;
            margin: 0 0.625rem;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: var(--accent-color);
        }

        .copyright {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .hourly-forecast {
            width: 100%;
            margin-top: 1.5rem;
        }

        .hourly-forecast h2 {
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .hourly-container {
            display: flex;
            overflow-x: auto;
            padding-bottom: 1rem;
            gap: 1rem;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) var(--primary-color);
        }

        .hourly-container::-webkit-scrollbar {
            height: 8px;
        }

        .hourly-container::-webkit-scrollbar-track {
            background: var(--primary-color);
            border-radius: 10px;
        }

        .hourly-container::-webkit-scrollbar-thumb {
            background-color: var(--accent-color);
            border-radius: 10px;
            border: 2px solid var(--primary-color);
        }

        .hour-card {
            flex: 0 0 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: var(--border-radius);
            border: 1px solid transparent;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
        }

        .hour-card.active,
        .hour-card:hover {
            background-color: var(--bg-hover);
            border-color: var(--accent-color);
        }

        .hour-card .time {
            font-weight: 700;
        }

        .hour-card .temp {
            font-size: 1.2rem;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none; /* Hidden by default */
        }

        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--accent-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .location-input {
                flex-direction: column;
                align-items: stretch;
            }
        }

        @media (max-width: 480px) {
            html {
                font-size: 14px;
            }

            header {
                padding: 1rem;
                padding-top: 4rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .language-tabs {
                top: 1rem;
                left: 50%;
                transform: translateX(-50%);
                width: max-content;
            }

            main {
                width: 95%;
                padding: 1rem;
            }

            .weather-info,
            .advanced-weather-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>
    <div class="weather-background"></div>
    <header>
        <div class="language-tabs">
            <button id="lang-it" class="lang-btn">
                <img src="https://flagcdn.com/w20/it.png" alt="Italian flag">
            </button>
            <button id="lang-en" class="lang-btn active">
                <img src="https://flagcdn.com/w20/gb.png" alt="British flag">
            </button>
        </div>
        <h1 data-translate="title" data-original-text="Weather Forecast">Weather Forecast</h1>
        <svg id="weather-icon" width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <!-- Weather icon will be dynamically inserted here -->
        </svg>
    </header>
    <div id="weather-banner" class="fade-in">Loading weather conditions...</div>
    <main>
        <section class="location-input">
            <div class="autocomplete-container">
                <input type="text" id="location" placeholder="Enter location" aria-label="Enter location" autocomplete="off">
                <div class="suggestions-container" id="suggestions-container"></div>
            </div>
            <select id="day-selector" aria-label="Select day">
                <option value="-7">7 Days Ago</option>
                <option value="-6">6 Days Ago</option>
                <option value="-5">5 Days Ago</option>
                <option value="-4">4 Days Ago</option>
                <option value="-3">3 Days Ago</option>
                <option value="-2">2 Days Ago</option>
                <option value="-1">Yesterday</option>
                <option value="0" selected>Today</option>
                <option value="1">Tomorrow</option>
                <option value="2">2 Days After</option>
                <option value="3">3 Days After</option>
                <option value="4">4 Days After</option>
                <option value="5">5 Days After</option>
                <option value="6">6 Days After</option>
                <option value="7">7 Days After</option>
            </select>
            <button aria-label="Update weather forecast">Update</button>
        </section>
        <section class="hourly-forecast">
            <h2 data-translate="hourlyForecastTitle" data-original-text="Hourly Forecast">Hourly Forecast</h2>
            <div class="hourly-container" id="hourly-container">
                <!-- Hourly cards will be injected here by JavaScript -->
            </div>
        </section>
        <section class="weather-info fade-in">
            <div class="weather-item">
                <span data-translate="date" data-original-text="Date and Time:">Date and Time:</span>
                <span id="datetime">--</span>
            </div>
            <div class="weather-item">
                <span data-translate="temperature" data-original-text="Temperature:">Temperature:</span>
                <span id="temperature">-- °C</span>
            </div>
            <div class="weather-item">
                <span data-translate="humidity" data-original-text="Humidity:">Humidity:</span>
                <span id="humidity">--%</span>
            </div>
            <div class="weather-item">
                <span data-translate="windSpeed" data-original-text="Wind Speed:">Wind Speed:</span>
                <span id="wind-speed">-- km/h</span>
            </div>
            <div class="weather-item">
                <span data-translate="precipitation" data-original-text="Precipitation:">Precipitation:</span>
                <span id="precipitation">-- mm</span>
            </div>
            <div class="weather-item">
                <span data-translate="uvIndex" data-original-text="UV Index:">UV Index:</span>
                <span id="uv-index">--</span>
            </div>
            <div class="weather-item">
                <span data-translate="sunrise" data-original-text="Sunrise:">Sunrise:</span>
                <span id="sunrise">--:--</span>
            </div>
            <div class="weather-item">
                <span data-translate="sunset" data-original-text="Sunset:">Sunset:</span>
                <span id="sunset">--:--</span>
            </div>
            <div class="weather-item">
                <span data-translate="visibility" data-original-text="Visibility:">Visibility:</span>
                <span id="visibility">-- km</span>
            </div>
            <div class="weather-item">
                <span data-translate="pressure" data-original-text="Pressure:">Pressure:</span>
                <span id="pressure">-- hPa</span>
            </div>
            <div class="weather-item" style="grid-column: 1 / -1;">
                <span data-translate="weatherAlerts" data-original-text="Weather Alerts:">Weather Alerts:</span>
                <div id="alerts" data-original-text="No alerts">No alerts</div>
            </div>
        </section>
        <section class="advanced-weather-info fade-in" style="display: none;">
            <h2 data-translate="advancedDataTitle" data-original-text="Advanced Weather Data">Advanced Weather Data</h2>
            <div class="weather-item">
                <span data-translate="precipitationProbability" data-original-text="Precipitation Probability:">Precipitation Probability:</span>
                <span id="precipitation-probability">--%</span>
            </div>
            <div class="weather-item">
                <span data-translate="precipitationHours" data-original-text="Precipitation Hours:">Precipitation Hours:</span>
                <span id="precipitation-hours">-- hours</span>
            </div>
            <div class="weather-item">
                <span data-translate="rain" data-original-text="Rain:">Rain:</span>
                <span id="rain-sum">-- mm</span>
            </div>
            <div class="weather-item">
                <span data-translate="showers" data-original-text="Showers:">Showers:</span>
                <span id="showers-sum">-- mm</span>
            </div>
            <div class="weather-item">
                <span data-translate="snowfall" data-original-text="Snowfall:">Snowfall:</span>
                <span id="snowfall-sum">-- cm</span>
            </div>
            <div class="weather-item">
                <span data-translate="windGusts" data-original-text="Wind Gusts:">Wind Gusts:</span>
                <span id="windgusts">-- km/h</span>
            </div>
        </section>
        <button id="toggle-advanced" aria-label="Show/Hide advanced information">Advanced Information</button>
        <section class="map-container fade-in">
            <img id="map-image" src="" alt="Location Map" style="width: 100%; height: 100%; object-fit: cover;">
        </section>
    </main>
    <footer>
        <div class="social-icons">
            <a href="https://facebook.com" target="_blank" aria-label="Facebook">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/>
                </svg>
            </a>
            <a href="https://twitter.com" target="_blank" aria-label="Twitter">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/>
                </svg>
            </a>
            <a href="https://instagram.com" target="_blank" aria-label="Instagram">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                </svg>
            </a>
        </div>
        <div class="footer-links">
            <a href="/privacy" data-translate="privacy">Privacy</a>
            <a href="/terms" data-translate="terms">Terms</a>
        </div>
        <div class="copyright">
            © 2024 Created by Mauro Col (AIZero), All rights reserved
        </div>
    </footer>
    <script>
        const translations = {
            en: {
                title: "Weather Forecast",
                locationPlaceholder: "Enter location",
                updateButton: "Update",
                advancedInfoButton: "Advanced Information",
                hideAdvancedInfoButton: "Hide Advanced Information",
                date: "Date and Time:",
                temperature: "Temperature:",
                humidity: "Humidity:",
                windSpeed: "Wind Speed:",
                precipitation: "Precipitation:",
                uvIndex: "UV Index:",
                sunrise: "Sunrise:",
                sunset: "Sunset:",
                visibility: "Visibility:",
                pressure: "Pressure:",
                weatherAlerts: "Weather Alerts:",
                noAlerts: "No alerts",
                advancedDataTitle: "Advanced Weather Data",
                precipitationProbability: "Precipitation Probability:",
                precipitationHours: "Precipitation Hours:",
                rain: "Rain:",
                showers: "Showers:",
                snowfall: "Snowfall:",
                windGusts: "Wind Gusts:",
                privacy: "Privacy",
                terms: "Terms",
                daySelector: {
                    "-7": "7 Days Ago",
                    "-6": "6 Days Ago",
                    "-5": "5 Days Ago",
                    "-4": "4 Days Ago",
                    "-3": "3 Days Ago",
                    "-2": "2 Days Ago",
                    "-1": "Yesterday",
                    "0": "Today",
                    "1": "Tomorrow",
                    "2": "2 Days After",
                    "3": "3 Days After",
                    "4": "4 Days After",
                    "5": "5 Days After",
                    "6": "6 Days After",
                    "7": "7 Days After"
                }
            }
        };

        const weatherApp = {
            translations: {
                en: {
                    title: "Weather Forecast 🌦️",
                    hourlyForecastTitle: "Hourly Forecast",
                    locationPlaceholder: "Enter location",
                    updateButton: "Update 🔄",
                    advancedInfoButton: "Advanced Information",
                    hideAdvancedInfoButton: "Hide Advanced Information",
                    date: "Date and Time:",
                    temperature: "Temperature: 🌡️",
                    humidity: "Humidity: 💧",
                    windSpeed: "Wind Speed: 💨",
                    precipitation: "Precipitation: 🌧️",
                    uvIndex: "UV Index: ☀️",
                    sunrise: "Sunrise: 🌅",
                    sunset: "Sunset: 🌇",
                    visibility: "Visibility: 👁️",
                    pressure: "Pressure: 📈",
                    weatherAlerts: "Weather Alerts: ⚠️",
                    noAlerts: "No alerts",
                    advancedDataTitle: "Advanced Weather Data",
                    precipitationProbability: "Precipitation Probability:  확률",
                    precipitationHours: "Precipitation Hours: 🕒",
                    rain: "Rain: ☔",
                    showers: "Showers: 🚿",
                    snowfall: "Snowfall: ❄️",
                    windGusts: "Wind Gusts: 🌬️",
                    privacy: "Privacy",
                    terms: "Terms",
                    daySelector: {
                        "-7": "7 Days Ago", "-6": "6 Days Ago", "-5": "5 Days Ago", "-4": "4 Days Ago",
                        "-3": "3 Days Ago", "-2": "2 Days Ago", "-1": "Yesterday", "0": "Today", "1": "Tomorrow",
                        "2": "2 Days After", "3": "3 Days After", "4": "4 Days After", "5": "5 Days After",
                        "6": "6 Days After", "7": "7 Days After"
                    }
                },
                it: {
                    title: "Previsioni Meteo 🌦️",
                    hourlyForecastTitle: "Previsioni Orarie",
                    locationPlaceholder: "Inserisci località",
                    updateButton: "Aggiorna 🔄",
                    advancedInfoButton: "Informazioni Avanzate",
                    hideAdvancedInfoButton: "Nascondi Informazioni Avanzate",
                    date: "Data e Ora:",
                    temperature: "Temperatura: 🌡️",
                    humidity: "Umidità: 💧",
                    windSpeed: "Velocità del Vento: 💨",
                    precipitation: "Precipitazioni: 🌧️",
                    uvIndex: "Indice UV: ☀️",
                    sunrise: "Alba: 🌅",
                    sunset: "Tramonto: 🌇",
                    visibility: "Visibilità: 👁️",
                    pressure: "Pressione: 📈",
                    weatherAlerts: "Allerte Meteo: ⚠️",
                    noAlerts: "Nessuna allerta",
                    advancedDataTitle: "Dati Meteo Avanzati",
                    precipitationProbability: "Probabilità di Precipitazioni: 확률",
                    precipitationHours: "Ore di Precipitazione: 🕒",
                    rain: "Pioggia: ☔",
                    showers: "Rovesci: 🚿",
                    snowfall: "Nevicata: ❄️",
                    windGusts: "Raffiche di Vento: 🌬️",
                    privacy: "Privacy",
                    terms: "Termini",
                    daySelector: {
                        "-7": "7 Giorni Fa", "-6": "6 Giorni Fa", "-5": "5 Giorni Fa", "-4": "4 Giorni Fa",
                        "-3": "3 Giorni Fa", "-2": "2 Giorni Fa", "-1": "Ieri", "0": "Oggi", "1": "Domani",
                        "2": "2 Giorni Dopo", "3": "3 Giorni Dopo", "4": "4 Giorni Dopo", "5": "5 Giorni Dopo",
                        "6": "6 Giorni Dopo", "7": "7 Giorni Dopo"
                    }
                }
            },

            init() {
                document.addEventListener("DOMContentLoaded", () => {
                    this.cacheDOMElements();
                    this.addEventListeners();
                    this.prepareTranslations();

                    const savedLang = localStorage.getItem('weatherLang') || 'en';
                    this.switchLanguage(savedLang);

                    const savedLocation = localStorage.getItem('weatherLocation');
                    if (savedLocation) {
                        this.dom.locationInput.value = savedLocation;
                    }

                    this.fetchWeather();
                });
            },

            cacheDOMElements() {
                this.dom = {
                    langButtons: document.querySelectorAll('.lang-btn'),
                    translatableElements: document.querySelectorAll('[data-translate]'),
                    locationInput: document.getElementById('location'),
                    daySelector: document.getElementById('day-selector'),
                    updateButton: document.querySelector('.location-input button'),
                    advancedButton: document.getElementById('toggle-advanced'),
                    advancedSection: document.querySelector('.advanced-weather-info'),
                    weatherBanner: document.getElementById('weather-banner'),
                    weatherIcon: document.getElementById('weather-icon'),
                    hourlyContainer: document.getElementById('hourly-container'),
                    mapImage: document.getElementById('map-image'),
                    suggestionsContainer: document.getElementById('suggestions-container'),
                    loadingOverlay: document.getElementById('loading-overlay')
                };
            },

            addEventListeners() {
                this.dom.langButtons.forEach(btn => {
                    btn.addEventListener('click', () => this.switchLanguage(btn.id.split('-')[1]));
                });
                this.dom.updateButton.addEventListener('click', () => this.fetchWeather());
                this.dom.advancedButton.addEventListener('click', () => this.toggleAdvancedInfo());
                this.dom.hourlyContainer.addEventListener('click', (e) => {
                    const card = e.target.closest('.hour-card');
                    if (card) {
                        this.updateMainDisplay(card.dataset.hourIndex);
                    }
                });

                this.dom.locationInput.addEventListener('input', () => this.fetchCitySuggestions());
                this.dom.suggestionsContainer.addEventListener('click', (e) => {
                    const suggestion = e.target.closest('.suggestion-item');
                    if (suggestion) {
                        this.dom.locationInput.value = suggestion.dataset.cityName;
                        this.dom.suggestionsContainer.innerHTML = '';
                        this.fetchWeather(suggestion.dataset.locationName);
                    }
                });
            },

            fetchCitySuggestions() {
                const query = this.dom.locationInput.value;
                if (query.length < 3) {
                    this.dom.suggestionsContainer.innerHTML = '';
                    return;
                }

                fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=5&language=en&format=json`)
                    .then(res => res.json())
                    .then(data => {
                        this.dom.suggestionsContainer.innerHTML = '';
                        if (data.results) {
                            data.results.forEach(city => {
                                const div = document.createElement('div');
                                const locationName = `${city.name}, ${city.country}`;
                                div.textContent = `${city.name}, ${city.admin1 || ''}, ${city.country}`.replace(/, ,/g, ',');
                                div.dataset.locationName = locationName;
                                div.dataset.cityName = city.name;
                                div.className = 'suggestion-item';
                                this.dom.suggestionsContainer.appendChild(div);
                            });
                        }
                    });
            },

            prepareTranslations() {
                this.dom.translatableElements.forEach(el => {
                    el.setAttribute('data-original-text', el.textContent);
                });
            },

            switchLanguage(lang) {
                this.dom.langButtons.forEach(btn => btn.classList.remove('active'));
                document.getElementById(`lang-${lang}`).classList.add('active');
                localStorage.setItem('weatherLang', lang);

                const targetLang = this.translations[lang] || this.translations.en;

                this.dom.translatableElements.forEach(el => {
                    const key = el.getAttribute('data-translate');
                    el.textContent = targetLang[key] || el.getAttribute('data-original-text');
                });

                this.updateDaySelector(lang);

                const bannerText = this.dom.weatherBanner.textContent;
                if (bannerText && bannerText.includes(':')) {
                    const condition = bannerText.split(': ')[1].split(' ')[0];
                    if (condition) this.updateBanner(condition);
                }

                this.dom.locationInput.placeholder = targetLang.locationPlaceholder;
                this.dom.updateButton.textContent = targetLang.updateButton;
                this.updateAdvancedButtonText();
            },

            updateDaySelector(lang) {
                const targetLang = this.translations[lang] || this.translations.en;
                Array.from(this.dom.daySelector.options).forEach((option) => {
                    const value = option.value;
                    if (targetLang.daySelector[value]) {
                        option.text = targetLang.daySelector[value];
                    }
                });
            },

            updateAdvancedButtonText() {
                const lang = document.getElementById('lang-en').classList.contains('active') ? 'en' : 'it';
                const isVisible = this.dom.advancedSection.style.display !== 'none';
                if (lang === 'en') {
                    this.dom.advancedButton.textContent = isVisible ? this.translations.en.hideAdvancedInfoButton : this.translations.en.advancedInfoButton;
                } else {
                    this.dom.advancedButton.textContent = isVisible ? "Nascondi Info Avanzate" : "Mostra Info Avanzate";
                }
            },

            showLoading() {
                this.dom.loadingOverlay.style.display = 'flex';
            },

            hideLoading() {
                this.dom.loadingOverlay.style.display = 'none';
            },

            fetchWeather(locationOverride) {
                this.showLoading();
                const location = locationOverride || this.dom.locationInput.value || 'Rome';
                if(location) {
                    localStorage.setItem('weatherLocation', location);
                }
                const dayOffset = parseInt(this.dom.daySelector.value);
                const date = new Date();
                date.setDate(date.getDate() + dayOffset);
                const formattedDate = date.toISOString().split('T')[0];

                fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(location)}&count=1&language=it&format=json`)
                    .then(res => res.ok ? res.json() : Promise.reject('Geocoding API error'))
                    .then(geoData => {
                        if (geoData.results && geoData.results.length > 0) {
                            const { latitude, longitude } = geoData.results[0];
                            const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&hourly=temperature_2m,relativehumidity_2m,precipitation_probability,weathercode,surface_pressure,visibility,windspeed_10m,uv_index&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_sum,precipitation_hours,windspeed_10m_max,windgusts_10m_max,uv_index_max,rain_sum,showers_sum,snowfall_sum&current_weather=true&timezone=auto&start_date=${formattedDate}&end_date=${formattedDate}`;
                            return fetch(url);
                        }
                        throw new Error('Location not found');
                    })
                    .then(res => res.ok ? res.json() : Promise.reject('Weather API error'))
                    .then(data => this.updateUI(data, formattedDate))
                    .catch(error => {
                        console.error('Error fetching data:', error);
                        this.dom.weatherBanner.textContent = 'Failed to load weather data. Please try again.';
                        this.dom.weatherBanner.style.backgroundColor = 'red';
                    })
                    .finally(() => this.hideLoading());
            },

            hourlyData: {},
            locationData: {},

            updateUI(data, date) {
                const { current_weather, daily, hourly } = data;
                this.hourlyData = hourly;
                this.locationData = { latitude: data.latitude, longitude: data.longitude };

                document.getElementById('datetime').textContent = `${date}, ${current_weather.time.split('T')[1]}`;
                document.getElementById('temperature').textContent = `${current_weather.temperature}°C`;
                document.getElementById('wind-speed').textContent = `${current_weather.windspeed} km/h`;
                document.getElementById('precipitation').textContent = `${daily.precipitation_sum[0]} mm`;
                document.getElementById('humidity').textContent = `${hourly.relativehumidity_2m[0]}%`;
                document.getElementById('uv-index').textContent = daily.uv_index_max[0].toFixed(1);
                document.getElementById('sunrise').textContent = daily.sunrise[0].split('T')[1];
                document.getElementById('sunset').textContent = daily.sunset[0].split('T')[1];
                document.getElementById('visibility').textContent = `${(hourly.visibility[0] / 1000).toFixed(1)} km`;
                document.getElementById('pressure').textContent = `${hourly.surface_pressure[0].toFixed(0)} hPa`;
                document.getElementById('precipitation-probability').textContent = `${hourly.precipitation_probability[0]}%`;
                document.getElementById('precipitation-hours').textContent = `${daily.precipitation_hours[0]} hours`;
                document.getElementById('rain-sum').textContent = `${daily.rain_sum[0]} mm`;
                document.getElementById('showers-sum').textContent = `${daily.showers_sum[0]} mm`;
                document.getElementById('snowfall-sum').textContent = `${daily.snowfall_sum[0]} cm`;
                document.getElementById('windgusts').textContent = `${daily.windgusts_10m_max[0]} km/h`;
                this.updateBanner(this.getWeatherCondition(current_weather.weathercode));
                this.displayHourlyForecast(hourly);
                this.updateMainDisplay(new Date().getHours());
            },

            updateMainDisplay(hourIndex) {
                const hourData = {
                    time: this.hourlyData.time[hourIndex],
                    temperature: this.hourlyData.temperature_2m[hourIndex],
                    humidity: this.hourlyData.relativehumidity_2m[hourIndex],
                    windspeed: this.hourlyData.windspeed_10m[hourIndex],
                    precipitation: this.hourlyData.precipitation_probability[hourIndex],
                    uvIndex: this.hourlyData.uv_index[hourIndex],
                    visibility: this.hourlyData.visibility[hourIndex],
                    pressure: this.hourlyData.surface_pressure[hourIndex],
                    weathercode: this.hourlyData.weathercode[hourIndex]
                };

                document.getElementById('datetime').textContent = `${hourData.time.split('T')[0]}, ${hourData.time.split('T')[1]}`;
                document.getElementById('temperature').textContent = `${hourData.temperature}°C`;
                document.getElementById('wind-speed').textContent = `${hourData.windspeed} km/h`;
                document.getElementById('precipitation').textContent = `${hourData.precipitation}%`;
                document.getElementById('humidity').textContent = `${hourData.humidity}%`;
                document.getElementById('uv-index').textContent = hourData.uvIndex.toFixed(1);
                document.getElementById('visibility').textContent = `${(hourData.visibility / 1000).toFixed(1)} km`;
                document.getElementById('pressure').textContent = `${hourData.pressure.toFixed(0)} hPa`;

                this.updateBanner(this.getWeatherCondition(hourData.weathercode));
                this.updateMap();

                // Highlight active card
                const allCards = this.dom.hourlyContainer.querySelectorAll('.hour-card');
                allCards.forEach(card => card.classList.remove('active'));
                const selectedCard = this.dom.hourlyContainer.querySelector(`[data-hour-index='${hourIndex}']`);
                if(selectedCard) {
                    selectedCard.classList.add('active');
                }
            },

            displayHourlyForecast(hourly) {
                this.dom.hourlyContainer.innerHTML = '';
                for (let i = 0; i < hourly.time.length; i++) {
                    const card = document.createElement('div');
                    card.className = 'hour-card';
                    card.dataset.hourIndex = i;

                    const time = new Date(hourly.time[i]).getHours();
                    const condition = this.getWeatherCondition(hourly.weathercode[i]);
                    const temp = hourly.temperature_2m[i];

                    card.innerHTML = `
                        <div class="time">${time}:00</div>
                        <div class="icon">${this.getWeatherEmoji(condition)}</div>
                        <div class="temp">${temp.toFixed(1)}°C</div>
                    `;
                    this.dom.hourlyContainer.appendChild(card);
                }
            },

            getWeatherEmoji(condition) {
                const emojiMap = {
                    'Sunny': '☀️',
                    'Slightly Cloudy': '🌤️',
                    'Partly Cloudy': '🌥️',
                    'Cloudy': '☁️',
                    'Foggy': '🌫️',
                    'Drizzle': '🌦️',
                    'Rain': '🌧️',
                    'Snow': '❄️',
                    'Thunderstorm': '⛈️',
                    'Windy': '💨',
                    'Variable Conditions': '🤷'
                };
                return emojiMap[condition] || '🤷';
            },

            getWeatherCondition(code) {
                const conditions = {
                    0: 'Sunny', 1: 'Slightly Cloudy', 2: 'Partly Cloudy', 3: 'Cloudy', 45: 'Foggy', 48: 'Foggy',
                    51: 'Drizzle', 53: 'Drizzle', 55: 'Drizzle', 61: 'Rain', 63: 'Rain', 65: 'Rain',
                    71: 'Snow', 73: 'Snow', 75: 'Snow', 95: 'Thunderstorm', 96: 'Thunderstorm', 99: 'Thunderstorm'
                };
                return conditions[code] || 'Variable Conditions';
            },

            getItalianWeatherCondition(condition) {
                const translations = {
                    'Sunny': 'Soleggiato', 'Slightly Cloudy': 'Leggermente Nuvoloso', 'Partly Cloudy': 'Parzialmente Nuvoloso',
                    'Cloudy': 'Nuvoloso', 'Foggy': 'Nebbia', 'Drizzle': 'Piovigine', 'Rain': 'Pioggia', 'Snow': 'Neve',
                    'Thunderstorm': 'Temporale', 'Windy': 'Ventoso', 'Variable Conditions': 'Condizioni Variabili'
                };
                return translations[condition] || 'Condizioni Variabili';
            },

            updateBanner(condition) {
                const banner = this.dom.weatherBanner;
                const background = document.querySelector('.weather-background');
                banner.className = 'fade-in'; // Reset classes
                background.className = 'weather-background';

                let conditionClass = 'cloudy', conditionText = condition, emoji = '☁️';

                if (['sunny'].includes(condition.toLowerCase())) {
                    conditionClass = 'sunny';
                    emoji = '☀️';
                }
                else if (['rain', 'drizzle'].includes(condition.toLowerCase())) {
                    conditionClass = 'rainy';
                    emoji = '🌧️';
                }
                else if (['snow'].includes(condition.toLowerCase())) {
                    conditionClass = 'snowy';
                    emoji = '❄️';
                }
                else if (['thunderstorm'].includes(condition.toLowerCase())) {
                    conditionClass = 'thunderstorm';
                    emoji = '⛈️';
                }
                 else if (['foggy'].includes(condition.toLowerCase())) {
                    emoji = '🌫️';
                }

                const lang = document.getElementById('lang-en').classList.contains('active') ? 'en' : 'it';
                banner.classList.add(conditionClass);
                background.classList.add(conditionClass);
                banner.textContent = `Current Weather: ${lang === 'en' ? conditionText : this.getItalianWeatherCondition(conditionText)} ${emoji}`;

                this.updateWeatherIcon(conditionText);
            },

            updateWeatherIcon(condition) {
                let iconContent = '';
                switch(condition.toLowerCase()) {
                    case 'sunny':
                        iconContent = '<circle cx="50" cy="50" r="25" class="sun" />';
                        break;
                    case 'cloudy':
                    case 'slightly cloudy':
                    case 'partly cloudy':
                        iconContent = '<circle cx="50" cy="50" r="20" class="sun" /><path d="M30 70 Q50 60 70 70" class="cloud" stroke-width="10" stroke="white" fill="none" />';
                        break;
                    case 'rain':
                    case 'drizzle':
                        iconContent = '<path d="M30 40 Q50 30 70 40" class="cloud" stroke-width="10" stroke="white" fill="none" /><line x1="40" y1="60" x2="35" y2="80" class="rain" stroke-width="2" /><line x1="50" y1="60" x2="45" y2="80" class="rain" stroke-width="2" /><line x1="60" y1="60" x2="55" y2="80" class="rain" stroke-width="2" />';
                        break;
                    case 'snow':
                        iconContent = '<path d="M30 40 Q50 30 70 40" class="cloud" stroke-width="10" stroke="white" fill="none" /><circle cx="40" cy="70" r="3" class="snow" /><circle cx="50" cy="75" r="3" class="snow" /><circle cx="60" cy="70" r="3" class="snow" />';
                        break;
                    case 'thunderstorm':
                        iconContent = '<path d="M30 40 Q50 30 70 40" class="cloud" stroke-width="10" stroke="white" fill="none" /><path d="M50 50 L45 70 L55 65 L50 85" class="lightning" stroke-width="2" />';
                        break;
                    default:
                        iconContent = '<circle cx="50" cy="50" r="25" class="sun" /><path d="M30 70 Q50 60 70 70" class="cloud" stroke-width="10" stroke="white" fill="none" />';
                }
                this.dom.weatherIcon.innerHTML = iconContent;
            },

            toggleAdvancedInfo() {
                const isVisible = this.dom.advancedSection.style.display !== 'none';
                this.dom.advancedSection.style.display = isVisible ? 'none' : 'grid';
                this.updateAdvancedButtonText();
            },

            updateMap() {
                if (this.locationData.latitude && this.locationData.longitude) {
                    const { latitude, longitude } = this.locationData;
                    const mapUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${longitude-0.1},${latitude-0.1},${longitude+0.1},${latitude+0.1}&layer=mapnik&marker=${latitude},${longitude}`;

                    // To avoid using an iframe for the embed, which might be blocked,
                    // we will use a static image from a different provider that uses OpenStreetMap data.
                    const staticMapUrl = `https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/pin-s+ff0000(${longitude},${latitude})/${longitude},${latitude},9,0/800x600?access_token=pk.eyJ1IjoiYWl6ZXJvIiwiYSI6ImNreWVhZ3ZqazA0Z2gyb3A1dG5sY2J3aXAifQ.l-5_b5t_FMMb2u3NSp2g7g`;

                    // Since we can't use Mapbox without an API key setup on the user side,
                    // let's use a simpler static map provider that does not require a key for simple use cases.
                    const finalMapUrl = `https://static-maps.yandex.ru/1.x/?ll=${longitude},${latitude}&z=10&l=map&size=600,450&pt=${longitude},${latitude},pm2rdl`;

                    this.dom.mapImage.src = finalMapUrl;
                    this.dom.mapImage.alt = `Map of the selected location`;
                }
            }
        };

        weatherApp.init();
    </script>
</body></html>
